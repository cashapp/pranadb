-- We test various different ways of encoding kafka messages with keys, values, headers JSON and binary etc;

-- TEST1 - string encoded key, top level JSON encoded value;

--create topic testtopic;

set max_line_width 300;
0 rows returned

use test;
0 rows returned

create source test_source_1(
    col0 bigint,
    col1 tinyint,
    col2 int,
    col3 double,
    col4 decimal(10, 2),
    col5 varchar,
    col6 timestamp(6),
    primary key (col5)
) with (
    brokername = "testbroker",
    topicname = "testtopic",
    headerencoding = "json",
    keyencoding = "stringbytes",
    valueencoding = "json",
    columnselectors = (
        v0,
        v1,
        v2,
        v3,
        v4,
        meta("key"),
        v6
    ),
    properties = (
        "prop1" = "val1",
        "prop2" = "val2"
    )
);
0 rows returned

--load data dataset_1;

select * from test_source_1 order by col0;
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| col0                 | col1 | col2        | col3                                                                     | col4                                                                     | col5                                                                     | col6                       |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -9223372036854775808 | -128 | -2147483648 | 1234.432100                                                              | 12345678.99                                                              | str1                                                                     | 2020-01-01 01:00:00.123456 |
| -4                   | -110 | 2000        | 2234.432100                                                              | 22345678.99                                                              | str2                                                                     | 2020-01-02 01:00:00.123457 |
| -3                   | -100 | 3000        | 3234.432100                                                              | 32345678.99                                                              | str3                                                                     | 2020-01-03 01:00:00.123458 |
| -2                   | -50  | 4000        | 4234.432100                                                              | 42345678.99                                                              | str4                                                                     | 2020-01-04 01:00:00.123459 |
| -1                   | -25  | 5000        | 5234.432100                                                              | 52345678.99                                                              | str5                                                                     | 2020-01-05 01:00:00.123460 |
| 0                    | 0    | 6000        | 6234.432100                                                              | 62345678.99                                                              | str6                                                                     | 2020-01-06 01:00:00.123461 |
| 1                    | 25   | 7000        | 7234.432100                                                              | 72345678.99                                                              | str7                                                                     | 2020-01-07 01:00:00.123462 |
| 2                    | 50   | 8000        | 8234.432100                                                              | 82345678.99                                                              | str8                                                                     | 2020-01-08 01:00:00.123463 |
| 3                    | 100  | 9000        | 9234.432100                                                              | 92345678.99                                                              | str9                                                                     | 2020-01-09 01:00:00.123464 |
| 9223372036854775807  | 127  | 2147483647  | 10234.432100                                                             | 93345678.99                                                              | str10                                                                    | 2020-01-10 01:00:00.123465 |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

drop source test_source_1;
0 rows returned

--delete topic testtopic;

-- TEST2 - int64BE encoded key, top level JSON encoded value;
------------------------------------------------------------;

--create topic testtopic;
create source test_source_1(
    col0 bigint,
    col1 tinyint,
    col2 int,
    col3 double,
    col4 decimal(10, 2),
    col5 varchar,
    col6 timestamp(6),
    primary key (col0)
) with (
    brokername = "testbroker",
    topicname = "testtopic",
    headerencoding = "json",
    keyencoding = "int64be",
    valueencoding = "json",
    columnselectors = (
        meta("key"),
        v1,
        v2,
        v3,
        v4,
        v5,
        v6
    ),
    properties = (
        "prop1" = "val1",
        "prop2" = "val2"
    )
);
0 rows returned

--load data dataset_2;

select * from test_source_1 order by col0;
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| col0                 | col1 | col2        | col3                                                                     | col4                                                                     | col5                                                                     | col6                       |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -9223372036854775808 | -128 | -2147483648 | 1234.432100                                                              | 12345678.99                                                              | str1                                                                     | 2020-01-01 01:00:00.123456 |
| -4                   | -110 | 2000        | 2234.432100                                                              | 22345678.99                                                              | str2                                                                     | 2020-01-02 01:00:00.123457 |
| -3                   | -100 | 3000        | 3234.432100                                                              | 32345678.99                                                              | str3                                                                     | 2020-01-03 01:00:00.123458 |
| -2                   | -50  | 4000        | 4234.432100                                                              | 42345678.99                                                              | str4                                                                     | 2020-01-04 01:00:00.123459 |
| -1                   | -25  | 5000        | 5234.432100                                                              | 52345678.99                                                              | str5                                                                     | 2020-01-05 01:00:00.123460 |
| 0                    | 0    | 6000        | 6234.432100                                                              | 62345678.99                                                              | str6                                                                     | 2020-01-06 01:00:00.123461 |
| 1                    | 25   | 7000        | 7234.432100                                                              | 72345678.99                                                              | str7                                                                     | 2020-01-07 01:00:00.123462 |
| 2                    | 50   | 8000        | 8234.432100                                                              | 82345678.99                                                              | str8                                                                     | 2020-01-08 01:00:00.123463 |
| 3                    | 100  | 9000        | 9234.432100                                                              | 92345678.99                                                              | str9                                                                     | 2020-01-09 01:00:00.123464 |
| 9223372036854775807  | 127  | 2147483647  | 10234.432100                                                             | 93345678.99                                                              | str10                                                                    | 2020-01-10 01:00:00.123465 |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

drop source test_source_1;
0 rows returned

--delete topic testtopic;

-- TEST3 - int32BE encoded key, top level JSON encoded value;
------------------------------------------------------------;

--create topic testtopic;
create source test_source_1(
    col0 bigint,
    col1 tinyint,
    col2 int,
    col3 double,
    col4 decimal(10, 2),
    col5 varchar,
    col6 timestamp(6),
    primary key (col2)
) with (
    brokername = "testbroker",
    topicname = "testtopic",
    headerencoding = "json",
    keyencoding = "int32be",
    valueencoding = "json",
    columnselectors = (
        v0,
        v1,
        meta("key"),
        v3,
        v4,
        v5,
        v6
    ),
    properties = (
        "prop1" = "val1",
        "prop2" = "val2"
    )
);
0 rows returned

--load data dataset_3;

select * from test_source_1 order by col0;
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| col0                 | col1 | col2        | col3                                                                     | col4                                                                     | col5                                                                     | col6                       |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -9223372036854775808 | -128 | -2147483648 | 1234.432100                                                              | 12345678.99                                                              | str1                                                                     | 2020-01-01 01:00:00.123456 |
| -4                   | -110 | 2000        | 2234.432100                                                              | 22345678.99                                                              | str2                                                                     | 2020-01-02 01:00:00.123457 |
| -3                   | -100 | 3000        | 3234.432100                                                              | 32345678.99                                                              | str3                                                                     | 2020-01-03 01:00:00.123458 |
| -2                   | -50  | 4000        | 4234.432100                                                              | 42345678.99                                                              | str4                                                                     | 2020-01-04 01:00:00.123459 |
| -1                   | -25  | 5000        | 5234.432100                                                              | 52345678.99                                                              | str5                                                                     | 2020-01-05 01:00:00.123460 |
| 0                    | 0    | 6000        | 6234.432100                                                              | 62345678.99                                                              | str6                                                                     | 2020-01-06 01:00:00.123461 |
| 1                    | 25   | 7000        | 7234.432100                                                              | 72345678.99                                                              | str7                                                                     | 2020-01-07 01:00:00.123462 |
| 2                    | 50   | 8000        | 8234.432100                                                              | 82345678.99                                                              | str8                                                                     | 2020-01-08 01:00:00.123463 |
| 3                    | 100  | 9000        | 9234.432100                                                              | 92345678.99                                                              | str9                                                                     | 2020-01-09 01:00:00.123464 |
| 9223372036854775807  | 127  | 2147483647  | 10234.432100                                                             | 93345678.99                                                              | str10                                                                    | 2020-01-10 01:00:00.123465 |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

drop source test_source_1;
0 rows returned

--delete topic testtopic;

-- TEST4 - float64BE encoded key, top level JSON encoded value;
--------------------------------------------------------------;

--create topic testtopic;
create source test_source_1(
    col0 bigint,
    col1 tinyint,
    col2 int,
    col3 double,
    col4 decimal(10, 2),
    col5 varchar,
    col6 timestamp(6),
    primary key (col3)
) with (
    brokername = "testbroker",
    topicname = "testtopic",
    headerencoding = "json",
    keyencoding = "float64be",
    valueencoding = "json",
    columnselectors = (
        v0,
        v1,
        v2,
        meta("key"),
        v4,
        v5,
        v6
    ),
    properties = (
        "prop1" = "val1",
        "prop2" = "val2"
    )
);
0 rows returned

--load data dataset_4;

select * from test_source_1 order by col0;
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| col0                 | col1 | col2        | col3                                                                     | col4                                                                     | col5                                                                     | col6                       |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -9223372036854775808 | -128 | -2147483648 | 1234.432100                                                              | 12345678.99                                                              | str1                                                                     | 2020-01-01 01:00:00.123456 |
| -4                   | -110 | 2000        | 2234.432100                                                              | 22345678.99                                                              | str2                                                                     | 2020-01-02 01:00:00.123457 |
| -3                   | -100 | 3000        | 3234.432100                                                              | 32345678.99                                                              | str3                                                                     | 2020-01-03 01:00:00.123458 |
| -2                   | -50  | 4000        | 4234.432100                                                              | 42345678.99                                                              | str4                                                                     | 2020-01-04 01:00:00.123459 |
| -1                   | -25  | 5000        | 5234.432100                                                              | 52345678.99                                                              | str5                                                                     | 2020-01-05 01:00:00.123460 |
| 0                    | 0    | 6000        | 6234.432100                                                              | 62345678.99                                                              | str6                                                                     | 2020-01-06 01:00:00.123461 |
| 1                    | 25   | 7000        | 7234.432100                                                              | 72345678.99                                                              | str7                                                                     | 2020-01-07 01:00:00.123462 |
| 2                    | 50   | 8000        | 8234.432100                                                              | 82345678.99                                                              | str8                                                                     | 2020-01-08 01:00:00.123463 |
| 3                    | 100  | 9000        | 9234.432100                                                              | 92345678.99                                                              | str9                                                                     | 2020-01-09 01:00:00.123464 |
| 9223372036854775807  | 127  | 2147483647  | 10234.432100                                                             | 93345678.99                                                              | str10                                                                    | 2020-01-10 01:00:00.123465 |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

drop source test_source_1;
0 rows returned

--delete topic testtopic;

-- TEST5 - float32BE encoded key, top level JSON encoded value;
--------------------------------------------------------------;

--create topic testtopic;
create source test_source_1(
    col0 bigint,
    col1 tinyint,
    col2 int,
    col3 double,
    col4 decimal(10, 2),
    col5 varchar,
    col6 timestamp(6),
    primary key (col3)
) with (
    brokername = "testbroker",
    topicname = "testtopic",
    headerencoding = "json",
    keyencoding = "float32be",
    valueencoding = "json",
    columnselectors = (
        v0,
        v1,
        v2,
        meta("key"),
        v4,
        v5,
        v6
    ),
    properties = (
        "prop1" = "val1",
        "prop2" = "val2"
    )
);
0 rows returned

--load data dataset_5;

select * from test_source_1 order by col0;
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| col0                 | col1 | col2        | col3                                                                     | col4                                                                     | col5                                                                     | col6                       |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -9223372036854775808 | -128 | -2147483648 | 1234.432129                                                              | 12345678.99                                                              | str1                                                                     | 2020-01-01 01:00:00.123456 |
| -4                   | -110 | 2000        | 2234.432129                                                              | 22345678.99                                                              | str2                                                                     | 2020-01-02 01:00:00.123457 |
| -3                   | -100 | 3000        | 3234.432129                                                              | 32345678.99                                                              | str3                                                                     | 2020-01-03 01:00:00.123458 |
| -2                   | -50  | 4000        | 4234.432129                                                              | 42345678.99                                                              | str4                                                                     | 2020-01-04 01:00:00.123459 |
| -1                   | -25  | 5000        | 5234.432129                                                              | 52345678.99                                                              | str5                                                                     | 2020-01-05 01:00:00.123460 |
| 0                    | 0    | 6000        | 6234.432129                                                              | 62345678.99                                                              | str6                                                                     | 2020-01-06 01:00:00.123461 |
| 1                    | 25   | 7000        | 7234.432129                                                              | 72345678.99                                                              | str7                                                                     | 2020-01-07 01:00:00.123462 |
| 2                    | 50   | 8000        | 8234.431641                                                              | 82345678.99                                                              | str8                                                                     | 2020-01-08 01:00:00.123463 |
| 3                    | 100  | 9000        | 9234.431641                                                              | 92345678.99                                                              | str9                                                                     | 2020-01-09 01:00:00.123464 |
| 9223372036854775807  | 127  | 2147483647  | 10234.431641                                                             | 93345678.99                                                              | str10                                                                    | 2020-01-10 01:00:00.123465 |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

drop source test_source_1;
0 rows returned

--delete topic testtopic;

-- TEST6 - int16BE encoded key, top level JSON encoded value;
--------------------------------------------------------------;

--create topic testtopic;
create source test_source_1(
    col0 bigint,
    col1 tinyint,
    col2 int,
    col3 double,
    col4 decimal(10, 2),
    col5 varchar,
    col6 timestamp(6),
    primary key (col2)
) with (
    brokername = "testbroker",
    topicname = "testtopic",
    headerencoding = "json",
    keyencoding = "int16be",
    valueencoding = "json",
    columnselectors = (
        v0,
        v1,
        meta("key"),
        v3,
        v4,
        v5,
        v6
    ),
    properties = (
        "prop1" = "val1",
        "prop2" = "val2"
    )
);
0 rows returned

--load data dataset_6;

select * from test_source_1 order by col0;
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| col0                 | col1 | col2        | col3                                                                     | col4                                                                     | col5                                                                     | col6                       |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -9223372036854775808 | -128 | 0           | 1234.432100                                                              | 12345678.99                                                              | str1                                                                     | 2020-01-01 01:00:00.123456 |
| -4                   | -110 | 2000        | 2234.432100                                                              | 22345678.99                                                              | str2                                                                     | 2020-01-02 01:00:00.123457 |
| -3                   | -100 | 3000        | 3234.432100                                                              | 32345678.99                                                              | str3                                                                     | 2020-01-03 01:00:00.123458 |
| -2                   | -50  | 4000        | 4234.432100                                                              | 42345678.99                                                              | str4                                                                     | 2020-01-04 01:00:00.123459 |
| -1                   | -25  | 5000        | 5234.432100                                                              | 52345678.99                                                              | str5                                                                     | 2020-01-05 01:00:00.123460 |
| 0                    | 0    | 6000        | 6234.432100                                                              | 62345678.99                                                              | str6                                                                     | 2020-01-06 01:00:00.123461 |
| 1                    | 25   | 7000        | 7234.432100                                                              | 72345678.99                                                              | str7                                                                     | 2020-01-07 01:00:00.123462 |
| 2                    | 50   | 8000        | 8234.432100                                                              | 82345678.99                                                              | str8                                                                     | 2020-01-08 01:00:00.123463 |
| 3                    | 100  | 9000        | 9234.432100                                                              | 92345678.99                                                              | str9                                                                     | 2020-01-09 01:00:00.123464 |
| 9223372036854775807  | 127  | -1          | 10234.432100                                                             | 93345678.99                                                              | str10                                                                    | 2020-01-10 01:00:00.123465 |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

drop source test_source_1;
0 rows returned

--delete topic testtopic;

-- TEST7 - top level JSON encoded key, top level JSON encoded value;

--create topic testtopic;
create source test_source_1(
    col0 bigint,
    col1 tinyint,
    col2 int,
    col3 double,
    col4 decimal(10, 2),
    col5 varchar,
    col6 timestamp(6),
    primary key (col0)
) with (
    brokername = "testbroker",
    topicname = "testtopic",
    headerencoding = "json",
    keyencoding = "json",
    valueencoding = "json",
    columnselectors = (
        meta("key").k0,
        v1,
        v2,
        v3,
        v4,
        v5,
        v6
    ),
    properties = (
        "prop1" = "val1",
        "prop2" = "val2"
    )
);
0 rows returned

--load data dataset_7;

select * from test_source_1 order by col0;
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| col0                 | col1 | col2        | col3                                                                     | col4                                                                     | col5                                                                     | col6                       |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -9223372036854775808 | -128 | -2147483648 | 1234.432100                                                              | 12345678.99                                                              | str1                                                                     | 2020-01-01 01:00:00.123456 |
| -4                   | -110 | 2000        | 2234.432100                                                              | 22345678.99                                                              | str2                                                                     | 2020-01-02 01:00:00.123457 |
| -3                   | -100 | 3000        | 3234.432100                                                              | 32345678.99                                                              | str3                                                                     | 2020-01-03 01:00:00.123458 |
| -2                   | -50  | 4000        | 4234.432100                                                              | 42345678.99                                                              | str4                                                                     | 2020-01-04 01:00:00.123459 |
| -1                   | -25  | 5000        | 5234.432100                                                              | 52345678.99                                                              | str5                                                                     | 2020-01-05 01:00:00.123460 |
| 0                    | 0    | 6000        | 6234.432100                                                              | 62345678.99                                                              | str6                                                                     | 2020-01-06 01:00:00.123461 |
| 1                    | 25   | 7000        | 7234.432100                                                              | 72345678.99                                                              | str7                                                                     | 2020-01-07 01:00:00.123462 |
| 2                    | 50   | 8000        | 8234.432100                                                              | 82345678.99                                                              | str8                                                                     | 2020-01-08 01:00:00.123463 |
| 3                    | 100  | 9000        | 9234.432100                                                              | 92345678.99                                                              | str9                                                                     | 2020-01-09 01:00:00.123464 |
| 9223372036854775807  | 127  | 2147483647  | 10234.432100                                                             | 93345678.99                                                              | str10                                                                    | 2020-01-10 01:00:00.123465 |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

drop source test_source_1;
0 rows returned

--delete topic testtopic;

-- TEST8 - nested JSON encoded key, nested JSON encoded value;

--create topic testtopic;
create source test_source_1(
    col0 bigint,
    col1 tinyint,
    col2 int,
    col3 double,
    col4 decimal(10, 2),
    col5 varchar,
    col6 timestamp(6),
    primary key (col0)
) with (
    brokername = "testbroker",
    topicname = "testtopic",
    headerencoding = "json",
    keyencoding = "json",
    valueencoding = "json",
    columnselectors = (
        meta("key").n0.k0,
        n1.v1,
        n2.v2,
        n3.v3,
        n4.v4,
        n5.v5,
        n6.v6
    ),
    properties = (
        "prop1" = "val1",
        "prop2" = "val2"
    )
);
0 rows returned

--load data dataset_8;

select * from test_source_1 order by col0;
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| col0                 | col1 | col2        | col3                                                                     | col4                                                                     | col5                                                                     | col6                       |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -9223372036854775808 | -128 | -2147483648 | 1234.432100                                                              | 12345678.99                                                              | str1                                                                     | 2020-01-01 01:00:00.123456 |
| -4                   | -110 | 2000        | 2234.432100                                                              | 22345678.99                                                              | str2                                                                     | 2020-01-02 01:00:00.123457 |
| -3                   | -100 | 3000        | 3234.432100                                                              | 32345678.99                                                              | str3                                                                     | 2020-01-03 01:00:00.123458 |
| -2                   | -50  | 4000        | 4234.432100                                                              | 42345678.99                                                              | str4                                                                     | 2020-01-04 01:00:00.123459 |
| -1                   | -25  | 5000        | 5234.432100                                                              | 52345678.99                                                              | str5                                                                     | 2020-01-05 01:00:00.123460 |
| 0                    | 0    | 6000        | 6234.432100                                                              | 62345678.99                                                              | str6                                                                     | 2020-01-06 01:00:00.123461 |
| 1                    | 25   | 7000        | 7234.432100                                                              | 72345678.99                                                              | str7                                                                     | 2020-01-07 01:00:00.123462 |
| 2                    | 50   | 8000        | 8234.432100                                                              | 82345678.99                                                              | str8                                                                     | 2020-01-08 01:00:00.123463 |
| 3                    | 100  | 9000        | 9234.432100                                                              | 92345678.99                                                              | str9                                                                     | 2020-01-09 01:00:00.123464 |
| 9223372036854775807  | 127  | 2147483647  | 10234.432100                                                             | 93345678.99                                                              | str10                                                                    | 2020-01-10 01:00:00.123465 |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

drop source test_source_1;
0 rows returned

--delete topic testtopic;

-- TEST9 - key and value encoded as message headers in JSON!;

--create topic testtopic;
create source test_source_1(
    col0 bigint,
    col1 tinyint,
    col2 int,
    col3 double,
    col4 decimal(10, 2),
    col5 varchar,
    col6 timestamp(6),
    primary key (col0)
) with (
    brokername = "testbroker",
    topicname = "testtopic",
    headerencoding = "json",
    keyencoding = "json",
    valueencoding = "json",
    columnselectors = (
        meta("header").key.k0,
        meta("header").val.v1,
        meta("header").val.v2,
        meta("header").val.v3,
        meta("header").val.v4,
        meta("header").val.v5,
        meta("header").val.v6
    ),
    properties = (
        "prop1" = "val1",
        "prop2" = "val2"
    )
);
0 rows returned

--load data dataset_9;

select * from test_source_1 order by col0;
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| col0                 | col1 | col2        | col3                                                                     | col4                                                                     | col5                                                                     | col6                       |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -9223372036854775808 | -128 | -2147483648 | 1234.432100                                                              | 12345678.99                                                              | str1                                                                     | 2020-01-01 01:00:00.123456 |
| -4                   | -110 | 2000        | 2234.432100                                                              | 22345678.99                                                              | str2                                                                     | 2020-01-02 01:00:00.123457 |
| -3                   | -100 | 3000        | 3234.432100                                                              | 32345678.99                                                              | str3                                                                     | 2020-01-03 01:00:00.123458 |
| -2                   | -50  | 4000        | 4234.432100                                                              | 42345678.99                                                              | str4                                                                     | 2020-01-04 01:00:00.123459 |
| -1                   | -25  | 5000        | 5234.432100                                                              | 52345678.99                                                              | str5                                                                     | 2020-01-05 01:00:00.123460 |
| 0                    | 0    | 6000        | 6234.432100                                                              | 62345678.99                                                              | str6                                                                     | 2020-01-06 01:00:00.123461 |
| 1                    | 25   | 7000        | 7234.432100                                                              | 72345678.99                                                              | str7                                                                     | 2020-01-07 01:00:00.123462 |
| 2                    | 50   | 8000        | 8234.432100                                                              | 82345678.99                                                              | str8                                                                     | 2020-01-08 01:00:00.123463 |
| 3                    | 100  | 9000        | 9234.432100                                                              | 92345678.99                                                              | str9                                                                     | 2020-01-09 01:00:00.123464 |
| 9223372036854775807  | 127  | 2147483647  | 10234.432100                                                             | 93345678.99                                                              | str10                                                                    | 2020-01-10 01:00:00.123465 |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

drop source test_source_1;
0 rows returned

--delete topic testtopic;

-- TEST10 - timestamp column value coming from timestamp of Kafka message;

--create topic testtopic;
create source test_source_1(
    col0 bigint,
    col1 tinyint,
    col2 int,
    col3 double,
    col4 decimal(10, 2),
    col5 varchar,
    col6 timestamp(6),
    primary key (col0)
) with (
    brokername = "testbroker",
    topicname = "testtopic",
    headerencoding = "json",
    keyencoding = "json",
    valueencoding = "json",
    columnselectors = (
        meta("key").k0,
        v1,
        v2,
        v3,
        v4,
        v5,
        meta("timestamp")
    ),
    properties = (
        "prop1" = "val1",
        "prop2" = "val2"
    )
);
0 rows returned

--load data dataset_10;

select * from test_source_1 order by col0;
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| col0                 | col1 | col2        | col3                                                                     | col4                                                                     | col5                                                                     | col6                       |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -9223372036854775808 | -128 | -2147483648 | 1234.432100                                                              | 12345678.99                                                              | str1                                                                     | 2021-04-12 09:00:00.000000 |
| -4                   | -110 | 2000        | 2234.432100                                                              | 22345678.99                                                              | str2                                                                     | 2021-04-12 09:00:00.000001 |
| -3                   | -100 | 3000        | 3234.432100                                                              | 32345678.99                                                              | str3                                                                     | 2021-04-12 09:00:00.000002 |
| -2                   | -50  | 4000        | 4234.432100                                                              | 42345678.99                                                              | str4                                                                     | 2021-04-12 09:00:00.000003 |
| -1                   | -25  | 5000        | 5234.432100                                                              | 52345678.99                                                              | str5                                                                     | 2021-04-12 09:00:00.000004 |
| 0                    | 0    | 6000        | 6234.432100                                                              | 62345678.99                                                              | str6                                                                     | 2021-04-12 09:00:00.000005 |
| 1                    | 25   | 7000        | 7234.432100                                                              | 72345678.99                                                              | str7                                                                     | 2021-04-12 09:00:00.000006 |
| 2                    | 50   | 8000        | 8234.432100                                                              | 82345678.99                                                              | str8                                                                     | 2021-04-12 09:00:00.000007 |
| 3                    | 100  | 9000        | 9234.432100                                                              | 92345678.99                                                              | str9                                                                     | 2021-04-12 09:00:00.000008 |
| 9223372036854775807  | 127  | 2147483647  | 10234.432100                                                             | 93345678.99                                                              | str10                                                                    | 2021-04-12 09:00:00.000009 |
+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

drop source test_source_1;
0 rows returned

--delete topic testtopic;

-- TEST11 - protobuf message;

--create topic testtopic;
create source test_source_1(
    col0 double,
    col1 double,
    col2 int,
    col3 bigint,
    col4 int,
    col5 bigint,
    col6 tinyint,
    col7 varchar,
    col8 int,
    col9 varchar,
    primary key (col7)
) with (
    brokername = "testbroker",
    topicname = "testtopic",
    headerencoding = "json",
    keyencoding = "stringbytes",
    valueencoding = "protobuf:squareup.cash.pranadb.testproto.v1.TestTypes",
    columnselectors = (
        double_field,
        float_field,
        int32_field,
        int64_field,
        uint32_field,
        uint64_field,
        bool_field,
        meta("key"),
        enum_field,
        enum_field
    ),
    properties = (
        "prop1" = "val1",
        "prop2" = "val2"
    )
);
0 rows returned

--load data dataset_11;

select * from test_source_1 order by col0;
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| col0                                             | col1                                             | col2        | col3                 | col4        | col5                 | col6 | col7                                             | col8        | col9                                             |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 1234.432100                                      | 123.320999                                       | 100         | 1000                 | 10000       | 100000               | 1    | str1                                             | 0           | COUNT_UNSPECIFIED                                |
| 2234.432100                                      | 223.320999                                       | -128        | 2000                 | 20000       | 200000               | 0    | str2                                             | 1           | COUNT_ONE                                        |
| 3234.432100                                      | 323.321014                                       | 300         | 3000                 | 30000       | 300000               | 1    | str3                                             | 2           | COUNT_TWO                                        |
| 4234.432100                                      | 423.321014                                       | 400         | 4000                 | 40000       | 400000               | 0    | str4                                             | 0           | COUNT_UNSPECIFIED                                |
| 5234.432100                                      | 523.320984                                       | 500         | 5000                 | 50000       | 500000               | 1    | str5                                             | 1           | COUNT_ONE                                        |
| 6234.432100                                      | 623.320984                                       | 600         | 6000                 | 60000       | 600000               | 0    | str6                                             | 2           | COUNT_TWO                                        |
| 7234.432100                                      | 723.320984                                       | 700         | 7000                 | 70000       | 700000               | 1    | str7                                             | 0           | COUNT_UNSPECIFIED                                |
| 8234.432100                                      | 823.320984                                       | 800         | 8000                 | 80000       | 800000               | 0    | str8                                             | 1           | COUNT_ONE                                        |
| 9234.432100                                      | 923.320984                                       | 900         | 9000                 | 90000       | 900000               | 1    | str9                                             | 2           | COUNT_TWO                                        |
| 10234.432100                                     | 1023.320984                                      | 1000        | 10000                | 100000      | 1000000              | 0    | str10                                            | 0           | COUNT_UNSPECIFIED                                |
+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
10 rows returned

drop source test_source_1;
0 rows returned

--delete topic testtopic;
